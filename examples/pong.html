<!DOCTYPE html>
<html class="deployment-type-development">
  <head>
    <meta charset="utf-8">
    <base target="_blank">

    <!-- GAME TEST -->
    <script src="../js/fc/ui/diff/Frame.js"></script>
    <script src="../js/fc/ui/diff/DOM-diff.js"></script>
    <script src="../js/fc/ui/diff/diffApply.js"></script>
    <!-- GAME TEST -->
    
    <title>Pong - The original entertainment super star console hit</title>
    <link rel="stylesheet" href="../css/friendlycode.css">
  </head>
  <body style="margin: 0">
    <div id="bare-fc-holder" class="friendlycode-loading"></div>

    <script src="../js/require-config.js"></script>
    <script src="../js/require.min.js"></script>

    <script>
    // Alternate publisher implementation that publishes to a hackpub
    // endpoint. For more information, see:
    // 
    //   https://github.com/hackasaurus/hackpub
    //
    // Note also that the Amazon S3 bucket hackpub publishes to must
    // be configured with a CORS configuration that allows for cross-origin
    // GET requests, e.g.:
    //
    //   <CORSConfiguration xmlns="http://s3.amazonaws.com/doc/2006-03-01/">
    //     <CORSRule>
    //       <AllowedOrigin>*</AllowedOrigin>
    //       <AllowedMethod>GET</AllowedMethod>
    //     </CORSRule>
    //   </CORSConfiguration>
     
    define("hackpub", ["jquery"], function($) {
      return function Hackpub(options) {
        return {
          loadCode: function(path, cb) {
            var url = options.publishURL + path;
            $.ajax({
              type: "GET",
              url: url,
              dataType: 'text',
              error: function(req) {
                cb(req);
              },
              success: function(html) {
                cb(null, html, url);
              }
            });
          },
          saveCode: function(data, originalURL, cb) {
            $.ajax({
              type: "POST",
              url: options.hackpubURL + "/publish",
              data: {
                'html': data,
                'original-url': originalURL
              },
              dataType: 'json',
              error: function(req) {
                cb(req);
              },
              success: function(result) {
                var url = result['published-url'];
                var path = '/' + url.match(/\/([A-Za-z0-9]+)$/)[1];
                cb(null, {path: path, url: options.publishURL + path});
              }
            });
          }
        };
      };
    });
    </script>

    <script type="text/html" class="pongTemplate">
‹h1›Pong!‹/h1›

‹p›Pong is the original computer game. Two paddles, a "ball" (even though it's actually
  a rectangle), and pure, unadulterated physics. ‹i›let's hack it.‹/i›‹/p›

‹section id="game"›
  ‹div id="world" tabindex="0"›
    ‹div class="top wall"›‹/div›
    ‹div class="bottom wall"›‹/div›
    ‹div class="paddle left" data-diff-ignore="style"›‹/div›
    ‹div class="paddle right" data-diff-ignore="style"›‹/div›
    ‹div class="ball" data-density="0" data-friction="0" data-bounciness="1" data-diff-ignore="style"›‹/div› 
  ‹/div›
  
  ‹div class="scores"›
    ‹span class="left"›0‹/span› : ‹span class="right"›0‹/span›
  ‹/div›

  ‹button onclick="start()"›Start the game‹/button›
  ‹button onclick="pause()"›Pause the game‹/button›
  
  ‹p›Controls: left player uses w/s to move, right player uses up/down arrows.‹/p›
‹/section›

‹!-- STYLING --›
‹style›
 #game {
    text-align: center;
  }

  #world {
    position: relative;
    height: 300px;
    width:  500px;
    background-color: #333;
    vertical-align: middle;
    margin: auto;
    overflow: hidden;
  }
  
  .paddle {
    position: absolute;
    display: inline-block;
    width: 10px;
    height: 100px;
    background-color: green;
    top: 40%;
  }
  
  .paddle.left { left: 10px; }
  .paddle.right { right: 10px; }

  .ball {
    position: absolute;
    background-color: white;
    width: 10px;
    height: 10px;
    top: 50%;
    left: 250px;
  }
  
  .wall {
    position: absolute;
    width: 100%;
    height: 5px;
    background-color: green;
  }
  
  .wall.top { top: 0; }
  .wall.bottom { bottom: 0; }
  
  .scores {
    width: 500px;
    margin: auto;
    background: black;
    color: white;
    font-size:200%;
    font-family: monospace;
    font-weight: bold;
  }
‹/style›

‹!-- SCRIPTS --›
‹script src="../js/Box2dWeb-2.1.a.3.js"›‹/script›
‹script src="../js/physics.js"›‹/script›
</script>
    

    <script>
    require([
      "jquery",
      "friendlycode",
      "hackpub"
    ], function($, FriendlycodeEditor, Hackpub) {
      var pongTemplate = $(".pongTemplate[type='text/html']").text().replace(/‹/g,'<').replace(/›/g,'>').trim();
      return FriendlycodeEditor({
        container: $("#bare-fc-holder"),
        defaultContent: pongTemplate,
        allowJS: true,
        publisher: Hackpub({
//          hackpubURL: "http://hackpub.hackasaurus.org",
//          publishURL: "http://poof.hksr.us"
          hackpubURL: "http://pomax.nihongoresources.com/downloads/temp/friendlypublish/post.php",
          publishURL: "http://pomax.nihongoresources.com/downloads/temp/friendlypublish/page"
        })
      });
    });
    </script>
  </body>
</html>
