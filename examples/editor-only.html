<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <base target="_blank">

    <title>Editor Only</title>
    <link rel="stylesheet" href="../css/friendlycode.css">

    <!-- TEST -->
    <script src="../js/fc/ui/diff/Frame.js"></script>
    <script src="../js/fc/ui/diff/DOM-diff.js"></script>
    <script src="../js/fc/ui/diff/diffApply.js"></script>
    <!-- TEST -->

  </head>
  <body style="margin: 0">
    <div id="editor" class="friendlycode-loading"></div>

    <script src="../js/require-config.js"></script>
    <script src="../js/require.min.js"></script>
    <script type="text/html">

‹h1›Our own mario game!‹/h1›

‹p›let's hack it.‹/p›

‹!--
  values!
--›
‹script type="text/processing" data-target="gameCanvas" onchange="update()"›
  // this are the dimensions of our game
  int screenWidth = 512;
  int screenHeight = 432;

  // this is "gravity"
  float DOWN_FORCE = 2;

  // this is the fall accelleration
  float ACCELERATION = 1.3;

  // and this is how much friction the ground has
  float DAMPENING = 0.75;
‹/script›

‹!--
  demo code
--›
‹script type="text/processing" data-target="gameCanvas" onchange="update()"›
void initialize()
{
  frameRate(30);
  addScreen("level", new MarioLevel(width, height));  
}
‹/script›

‹!--
  An "empty" level, with a single layer in it.
--›
‹script type="text/processing" data-target="gameCanvas" onchange="update()"›
class MarioLevel extends Level
{
  MarioLevel(float levelWidth, float levelHeight)
  {
    super(levelWidth, levelHeight);
    addLevelLayer("layer", new MarioLayer(this));
  }
}
‹/script›

‹!--
  An "empty" layer, with a blue background, and a "boundary" that acts as ground.
--›
‹script type="text/processing" data-target="gameCanvas" onchange="update()"›
  class MarioLayer extends LevelLayer
  {
    MarioLayer(Level owner)
    {
      super(owner);
      setBackgroundColor(color(0, 100, 190));
      // walls: ceiling
      addBoundary(new Boundary(width,48,0,48));
      // walls: left wall
      addBoundary(new Boundary(1,0,1,height));
      // walls: floor
      addBoundary(new Boundary(0,height-48,width,height-48));
      // walls: right wall
      addBoundary(new Boundary(width-1,height,width-1,0));
      showBoundaries = true;
      Mario mario = new Mario(width/2, height/2);
      addPlayer(mario);
    }
  }
‹/script›

‹script type="text/processing" data-target="gameCanvas" onchange="update()"›
  class Mario extends Player
  {
    Mario(float x, float y)
    {
      super("Mario");
      setupStates();
      handleKey('W');
      handleKey('A');
      handleKey('D');
      setPosition(x,y);
      setForces(0,DOWN_FORCE);
      setAcceleration(0,ACCELERATION);
      setImpulseCoefficients(DAMPENING,DAMPENING);
    }

    void setupStates()
    {
      addState(new State("idle", "../js/pjs/graphics/mario/small/Standing-mario.gif"));
      addState(new State("running", "../js/pjs/graphics/mario/small/Running-mario.gif",1,4));
      addState(new State("jumping", "../js/pjs/graphics/mario/small/Jumping-mario.gif"));
      addState(new State("dead", "../js/pjs/graphics/mario/small/Dead-mario.gif",1,2));
      setCurrentState("idle");    
    }

    void handleInput()
    {
      if (isKeyDown('A')) { addImpulse(-2, 0); }
      if (isKeyDown('D')) { addImpulse(2, 0); }
      if (isKeyDown('W')) { addImpulse(0,-10); }
    }
  }
‹/script›

‹!--
  This is the HTML element we're loading our game in.
--›
‹canvas id="gameCanvas"
        data-processing-sources="../js/pjs/preloads.pde ../js/pjs/codebase.pde"
        data-diff-ignore="style tabindex width height"›‹/canvas›

‹p›This is a very simple mario game, and we're going to remix it!‹/p›


‹!--

  ========================= LIBRARY CODE =========================

    the following scripts set up the game library loading for us.
    We don't actually want to change these, since they're needed
    to even do anything game-related in this tutorial =)

  ========================= LIBRARY CODE ========================= 

--›


<!-- audio library -->
‹script src="../js/pjs/minim.js"›‹/script›

<!-- Processing.js -->
‹script src="../js/pjs/processing.js"›‹/script›

<!-- Processing.js start-up handler -->
‹script›
(function setupReload() {
  if(typeof Processing !== "undefined") { Processing.reload(); }
  else { setTimeout(setupReload, 250); }}());
‹/script›

<!-- Processing.js sketch fragment updates -->
‹script›
  function update() {
    console.log("update() called as onchange for a text/processing script element.");
    Processing.reload();
  }
‹/script›
    
    </script>

    <script>
    require([
      "jquery",
      "fc/ui/editor"
    ], function($, Editor) {
      var template = $("*[type='text/html']").text().replace(/‹/g,'<').replace(/›/g,'>').trim();
      var editor = Editor({
        container: $("#editor"),
        value: template
      });
      editor.panes.codeMirror.focus();
    });
    </script>
  </body>
</html>
